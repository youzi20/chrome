{"version":3,"file":"document/injected-collect.js","mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C,oCAAoC,qBAAqB,iBAAiB;AACzH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC,6BAA6B,yDAAyD;AACtF;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://youzi-chrome/./src/js/document/injected-collect.ts"],"sourcesContent":["var InjectedScript = function () {\n    this.selectDom = null;\n    this.maskDiv = null;\n    this.eventListener();\n};\nInjectedScript.prototype.getText = function () {\n    return this.selectDom.innerText;\n};\nInjectedScript.prototype.getImages = function () {\n    var images = [];\n    var nodes = this.selectDom.parentElement.querySelectorAll(\"img\");\n    nodes.forEach(function (item) {\n        images.push({\n            src: item.src\n        });\n    });\n    return images;\n};\nInjectedScript.prototype.createMask = function () {\n    if (!this.selectDom)\n        return;\n    var _a = this.selectDom.getBoundingClientRect(), left = _a.left, top = _a.top, width = _a.width, height = _a.height;\n    if (!this.maskDiv) {\n        this.maskDiv = document.createElement(\"div\");\n        this.maskDiv.style = \"position: fixed; background: rgba(24, 112, 240, 0.5);pointer-events: none;z-index: 9999999;\";\n        document.body.appendChild(this.maskDiv);\n    }\n    this.maskDiv.style.width = width + \"px\";\n    this.maskDiv.style.height = height + \"px\";\n    this.maskDiv.style.top = top + \"px\";\n    this.maskDiv.style.left = left + \"px\";\n};\nInjectedScript.prototype.onMouseMoveHandle = function (e) {\n    var clientX = e.clientX, clientY = e.clientY;\n    var element = document.elementFromPoint(clientX, clientY);\n    if (this.selectDom && this.selectDom === element)\n        return;\n    this.selectDom = element;\n    this.createMask();\n};\nInjectedScript.prototype.onClickHandle = function (e) {\n    var _a;\n    var _this = this;\n    e.preventDefault();\n    e.stopPropagation();\n    var data = {\n        text: this.getText(),\n        images: this.getImages()\n    };\n    var keyName = window.location.host.replace(/\\./ig, \"_\") + \"_\" + Date.now();\n    console.log(keyName, data);\n    chrome.storage.sync.set((_a = {}, _a[keyName] = data, _a), function () {\n        window.postMessage({ ticker: \"document-injected-script\", storageKey: keyName }, '*');\n        _this.dispose();\n    });\n};\nInjectedScript.prototype.eventListener = function () {\n    this._onMouseMoveHandle = this.onMouseMoveHandle.bind(this);\n    this._onClickHandle = this.onClickHandle.bind(this);\n    window.addEventListener(\"mousemove\", this._onMouseMoveHandle);\n    window.addEventListener(\"click\", this._onClickHandle);\n};\nInjectedScript.prototype.dispose = function () {\n    InjectedScript = null;\n    this.maskDiv.remove();\n    window.removeEventListener(\"mousemove\", this._onMouseMoveHandle);\n    window.removeEventListener(\"click\", this._onClickHandle);\n};\nnew InjectedScript();\n"],"names":[],"sourceRoot":""}